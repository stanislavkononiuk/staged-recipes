{% set version = '1.7' %}

{% set posix = 'm2-' if win else '' %}
{% set native = 'm2w64-' if win else '' %}

package:
  name: r-magick
  version: {{ version|replace("-", "_") }}

source:
  fn: magick_{{ version }}.tar.gz
  url:
    - https://cran.r-project.org/src/contrib/magick_{{ version }}.tar.gz
    - https://cran.r-project.org/src/contrib/Archive/magick/magick_{{ version }}.tar.gz
  sha256: c42f012f510e485e73598a6f1d5a4bd6e84cbdc2435f3f48d2949a7b977bac25

build:
  number: 0
  # imagemagick package not available on win
  skip: true  # [win]
  rpaths:
    - lib/R/lib/
    - lib/

requirements:
  build:
    - r-base
    - r-rcpp
    - r-curl
    - r-knitr
    - r-magrittr
    - imagemagick
    - posix                # [win]
    - {{native}}toolchain  # [win]
    - gcc                  # [not win]

  run:
    - r-base
    - r-rcpp
    - r-curl
    - r-knitr
    - r-magrittr
    - imagemagick
    - libgcc  # [not win]

test:
  commands:
    - $R -e "library('magick')"  # [not win]
    - "\"%R%\" -e \"library('magick')\""  # [win]

about:
  home: https://github.com/ropensci/magick
  license: MIT
  summary: "Bindings to 'ImageMagick': the most comprehensive open-source image processing library
    available. Supports many common formats (png, jpeg, tiff, pdf, etc) and manipulations (rotate,
    scale, crop, trim, flip, blur, etc). All operations are vectorized via the Magick++ STL meaning
    they operate either on a single frame or a series of frames for working with layers, collages,
    or animation. In RStudio images are automatically previewed when printed to the console,
    resulting in an interactive editing environment. The latest version of the package includes a
    native graphics device for creating in-memory graphics or drawing onto images using pixel coordinates."
  license_family: MIT

extra:
  recipe-maintainers:
    - cbrueffer
    - johanneskoester
    - bgruening
    - daler
    - jdblischak
