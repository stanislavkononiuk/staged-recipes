{% set name = "hercules" %}
{% set version = "10.1.0" %}
{% set download_url = "https://github.com/src-d/hercules/releases/download" %}

package:
  name: "{{ name|lower }}"
  version: {{ version }}

source:
  fn: hercules.gz  # [unix]
  url: {{ download_url }}/v{{ version }}/{{ name }}.linux_amd64.gz          # [linux]
  sha256: 47821f0b9c3e23e4cea6caf029c90c7649abe9a100d25666107aa11f1b0efbd1  # [linux]

  url: {{ download_url }}/v{{ version }}/{{ name }}.darwin_amd64.gz         # [osx]
  sha256: 4861dd2fcfd1ec04982befb25f62ccc3eb5baa217d99a834bb8f039636488d94  # [osx]

  url: {{ download_url }}/v{{ version }}/{{ name }}.win64.zip               # [win]
  sha256: dcd5face27d300ce2062cf84fb44f6c3fb04a3b981fd34c516f55a713afb9ecf  # [win]

build:
  number: 0
  script:
    - gunzip hercules.gz               # [unix]
    - mkdir -p "$PREFIX/bin"           # [unix]
    - install hercules "$PREFIX/bin/"  # [unix]
    - mv hercules.exe "%LIBRARY_BIN%\hercules.exe"  # [win]

requirements:
  build: []

test:
  commands:
    # Skip the tests on Linux as binary file requires a more recent
    # version of GLIBC++ than the VM used to build and test packages.
    - hercules --help  # [not linux]
    - hercules --burndown --burndown-people --devs --pb https://github.com/conda-forge/conda-smithy > test.pb  # [not linux]

about:
  home: "https://github.com/src-d/hercules"
  license: Apache-2.0
  license_family: Apache
  license_file: LICENSE.md
  summary: |
    Hercules is an amazingly fast and highly customizable Git repository analysis
    engine written in Go. Batteries are included. Powered by go-git and Babelfish.

extra:
  recipe-maintainers:
    - dbast
