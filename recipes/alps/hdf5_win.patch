Index: config/FindHDF5.cmake
===================================================================
--- config/FindHDF5.cmake	(revision 7814)
+++ config/FindHDF5.cmake	(working copy)
@@ -82,7 +82,7 @@
 ENDIF(Hdf5_INCLUDE_DIRS)
 
 IF (WIN32 AND NOT UNIX)
-  SET(HDF5_DEFINITIONS "-D_HDF5USEDLL_" CACHE STRING "HDF5 defintions")
+  SET(HDF5_DEFINITIONS "-D_HDF5USEDLL_ -DH5_BUILT_AS_DYNAMIC_LIB" CACHE STRING "HDF5 defintions")
 ENDIF (WIN32 AND NOT UNIX)
 
 
Index: applications/dmrg/mps/CMakeLists.txt
===================================================================
--- applications/dmrg/mps/CMakeLists.txt	(revision 7814)
+++ applications/dmrg/mps/CMakeLists.txt	(working copy)
@@ -18,6 +18,9 @@
 
   list(APPEND ALPS_MPS_DEFINITIONS "-DDISABLE_MATRIX_ELEMENT_ITERATOR_WARNING")
   list(APPEND ALPS_MPS_DEFINITIONS "-DALPS_DISABLE_MATRIX_ELEMENT_ITERATOR_WARNING")
+  if(HDF5_DEFINITIONS)
+    list(APPEND ALPS_MPS_DEFINITIONS ${HDF5_DEFINITIONS})
+  endif(HDF5_DEFINITIONS)
 
   set(ALPS_MPS_LINKER_FLAGS "${LAPACK_LINKER_FLAGS}")
 
Index: applications/dmrg/tebd/CMakeLists.txt
===================================================================
--- applications/dmrg/tebd/CMakeLists.txt	(revision 7814)
+++ applications/dmrg/tebd/CMakeLists.txt	(working copy)
@@ -11,6 +11,9 @@
   set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} ${LAPACK_LINKER_FLAGS}")
   add_executable(tebd ${SOURCES})
   target_link_libraries(tebd ${HDF5_STATIC_LIBRARIES} ${HDF5_LIBRARIES} ${LAPACK_LIBRARY} ${BLAS_LIBRARY})
+  if(HDF5_DEFINITIONS)
+    set_target_properties(tebd PROPERTIES COMPILE_DEFINITIONS "${HDF5_DEFINITIONS}")
+  endif(HDF5_DEFINITIONS)
   install(TARGETS tebd RUNTIME DESTINATION bin COMPONENT applications)
 else(LAPACK_FOUND AND ALPS_BUILD_FORTRAN)
   message(STATUS "tebd will not be built")
Index: src/alps/CMakeLists.txt
===================================================================
--- src/alps/CMakeLists.txt	(revision 7814)
+++ src/alps/CMakeLists.txt	(working copy)
@@ -102,11 +102,16 @@
 endif (Boost_FOUND)
 
 if(BUILD_SHARED_LIBS)
-  set_target_properties(alps PROPERTIES COMPILE_DEFINITIONS "${ALPS_SHARED_CPPFLAGS}")
+  if(HDF5_DEFINITIONS)
+    set_target_properties(alps PROPERTIES COMPILE_DEFINITIONS "${ALPS_SHARED_CPPFLAGS} ${HDF5_DEFINITIONS}")
+  else(HDF5_DEFINITIONS)
+    set_target_properties(alps PROPERTIES COMPILE_DEFINITIONS "${ALPS_SHARED_CPPFLAGS}")
+  endif(HDF5_DEFINITIONS)
 else(BUILD_SHARED_LIBS)
   set_target_properties(alps PROPERTIES COMPILE_DEFINITIONS "${ALPS_STATIC_CPPFLAGS}")
 endif(BUILD_SHARED_LIBS)
 
+
 if(MSVC)
   get_target_property(LIB_NAME alps LOCATION)
   add_custom_command(TARGET alps POST_BUILD
