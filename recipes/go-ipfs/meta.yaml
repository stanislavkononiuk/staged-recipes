{% set version = "0.7.0" %}

package:
  name: go-ipfs
  version: {{ version }}

source:
  url: https://github.com/ipfs/go-ipfs/releases/download/v{{ version }}/go-ipfs-source.tar.gz
  sha256: c349802561a61c1efeade4e3e681723b76e9192edacc5a955cf5f68e49e57fba
  folder: src/github.com/ipfs/go-ipfs

build:
  number: 0
  skip: true  # [osx]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('go-cgo') }}  # [unix]
    - {{ compiler('go') }}  # [win]
    - posix  # [win]
    - go-licenses
    - make  # [unix]
  host:
    - openssl  # [unix]

test:
  files:
    - test_ipfs.sh
  requires:
    - posix  # [win]
  commands:
    - ipfs --version
    - bash test_ipfs.sh

about:
  home: https://ipfs.io
  license: Apache-2.0 or MIT
  license_file:
    - src/github.com/ipfs/go-ipfs/LICENSE-APACHE
    - src/github.com/ipfs/go-ipfs/LICENSE-MIT
    # TODO: on linux, about 10 upstreams fail (many are ipfs/ipld first-party)
    # - third-party-licenses.txt
    #
    #   gather_licenses ./third-party-licenses.txt "${module}/cmd/ipfs"
    #
    # fails with
    #
    #   F0206 15:06:39.374624  156753 main.go:43] one or more libraries have an incompatible/unknown license:
    #   map["unknown":[
    #       "github.com/ipfs/go-ipfs/vendor/github.com/ipfs/bbloom"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/ipfs/go-cidutil"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/ipfs/go-cidutil/cidenc"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/ipfs/go-ipld-git"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/ipfs/go-verifcid"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/ipld/go-car"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/ipld/go-car/util"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/libp2p/go-libp2p-asn-util"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/libp2p/go-libp2p-noise"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/libp2p/go-libp2p-noise/pb"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/multiformats/go-base36"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/whyrusleeping/base32"
    #       "github.com/ipfs/go-ipfs/vendor/github.com/whyrusleeping/cbor-gen"
    #   ]]

  summary: 'IPFS implementation in Go'

  # The remaining entries in this section are optional, but recommended.
  description: |
    IPFS is a global, versioned, peer-to-peer filesystem. It combines good ideas
    from previous systems such as Git, BitTorrent, Kademlia, SFS, and the Web.
    It is like a single BitTorrent swarm, exchanging git objects. IPFS provides
    an interface as simple as the HTTP web, but with permanence built-in. You
    can also mount the world at /ipfs.
  doc_url: https://docs.ipfs.io
  dev_url: https://github.com/ipfs/go-ipfs

extra:
  recipe-maintainers:
    - bollwyvl
