context:
  name: soci
  version: 4.0.1

package:
  name: '{{ name|lower }}'
  version: '{{ version }}'

source:
  url: https://github.com/SOCI/soci/archive/{{ version }}.tar.gz
  sha256: fa69347b1a1ef74450c0382b665a67bd6777cc7005bbe09726479625bcf1e29c

build:
  number: 0

outputs:
  - package:
      name: soci-core
    build: {}
    requirements:
      build:
        - '{{ compiler("cxx") }}'
        - cmake
        - sel(unix): make

    test:
      commands:
    about:
      summary: SOCI is a general purpose database written in C++.
      doc_source_url: http://soci.sourceforge.net/doc/release/4.0/

  - package:
      name: soci-sqlite
    build:
      script: build.sh
    requirements:
      build:
        - '{{ compiler("cxx") }}'
        - cmake
        - sel(unix): make
      host:
        - sqlite
        - soci-core
      run:
        - sqlite
        - soci-core

    test:
      commands:
        - sel(unix): test -f ${PREFIX}/lib/libsoci_sqlite.so
        # - if exist %LIBRARY_PREFIX%\lib\libsoci_core.dll (exit 0) else (exit 1)  # [win]

    about:
      summary: soci-sqlite3 contains SOCI core and the C++ implementation of SQLite3.
      doc_source_url: http://soci.sourceforge.net/doc/release/4.0/

  - package:
      name: soci-mysql
    build:
      script: build.sh
    requirements:
      build:
        - '{{ compiler("cxx") }}'
        - cmake
        - sel(unix): make
      host:
        - soci-core
        - mysql
      run:
        - soci-core
        - mysql

    test:
      commands:
        - sel(unix): test -f ${PREFIX}/lib/libsoci_mysql.so
        # - if exist %LIBRARY_PREFIX%\lib\libsoci_core.dll (exit 0) else (exit 1)  # [win]

    about:
      summary: soci-mysql contains SOCI core and the C++ implementation of MySQL.
      doc_source_url: http://soci.sourceforge.net/doc/release/4.0/

  - package:
      name: soci-postgresql
    build:
      script: build.sh
    requirements:
      build:
        - '{{ compiler("cxx") }}'
        - cmake
        - sel(unix): make
      host:
        - postgresql
        - soci-core
      run:
        - postgresql
        - soci-core

    test:
      commands:
        - sel(unix): test -f ${PREFIX}/lib/libsoci_postgresql.so
        # - if exist %LIBRARY_PREFIX%\lib\libsoci_core.dll (exit 0) else (exit 1)  # [win]

    about:
      summary: soci-postgresql contains SOCI core and the C++ implementation of PostgreSQL.
      doc_source_url: http://soci.sourceforge.net/doc/release/4.0/

about:
  home: http://soci.sourceforge.net/
  license: BSD-3-Clause
  license_family: BSD
  license_file: LICENSE
  summary: SOCI is a general purpose database written in C++.
  doc_url: http://soci.sourceforge.net/doc/release/4.0/

extra:
  recipe-maintainers:
    - SylvainCorlay
    - JohanMabille
    - marimeireles

