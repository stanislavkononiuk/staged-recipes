{% set name = "fastscapelib" %}
{% set version = "0.1.0" %}
{% set sha256 = "c0a83e391ef8ae6916427b85af33d0ce4749d07e9943c752515eaf02d2a5ae8a" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  fn: {{ name }}-v{{ version }}.tar.gz
  url: https://github.com/fastscape-lem/fastscapelib/archive/v{{ version }}.tar.gz
  sha256: {{ sha256 }}

build:
  number: 0
  skip: True  # [py2k]

outputs:
  - name: fastscapelib
    script: install_cpp_headers.sh   # [unix]
    script: install_cpp_headers.bat  # [win]
    build:
      activate_in_script: True
    requirements:
      build:
        - {{ compiler('cxx') }}
        - cmake
      host:
        - xtensor >=0.17.1,<0.18.0
      run:
        - xtensor >=0.17.1,<0.18.0
    test:
      commands:
        - test -f ${PREFIX}/include/fastscapelib/fastscapelib.hpp  # [unix]
        - test -f ${PREFIX}/lib/cmake/fastscapelib/fastscapelibConfig.cmake  # [unix]
        - test -f ${PREFIX}/lib/cmake/fastscapelib/fastscapelibConfigVersion.cmake  # [unix]
        - if exist %LIBRARY_PREFIX%\include\fastscapelib\fastscapelib.hpp (exit 0) else (exit 1)  # [win]
        - if exist %LIBRARY_PREFIX%\lib\cmake\fastscapelibConfig.cmake (exit 0) else (exit 1)  # [win]
        - if exist %LIBRARY_PREFIX%\lib\cmake\fastscapelibConfigVersion.cmake (exit 0) else (exit 1)  # [win]
  - name: fastscapelib-python
    script: install_python.sh   # [unix]
    script: install_python.bat  # [win]
    build:
      activate_in_script: True
    requirements:
      build:
        - {{ compiler('cxx') }}  # [win]
        - gcc_linux-64  # [linux]
        - clang_osx-64  # [osx]
        - cmake
        - xtensor >=0.17.1,<0.18.0
        - xtensor-python
        - python {{ python }}
        - setuptools
        - pybind11
        - numpy
      host:
        - python
        - numpy
      run:
        - python
        - {{ pin_compatible('numpy') }}
    test:
      imports:
        - fastscapelib

about:
  home: https://github.com/fastscape-lem/fastscapelib
  doc_url: https://fastscapelib.readthedocs.io
  license: GPLv3
  license_file: LICENSE
  summary: 'Library for topographic analysis and modeling'
  description: |
    Fastscapelib is a C++ library that implements efficient algorithms
    for processing topographic data and landscape evolution
    modeling. It also has Python bindings.

extra:
  recipe-maintainers:
    - benbovy
