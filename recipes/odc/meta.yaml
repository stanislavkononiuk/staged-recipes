{% set name = "odc" %}
{% set version = "1.3.0" %}
{% set ecbuild_version = "3.6.2" %}
{% set eckit_version = "1.16.3" %}


package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - url: https://github.com/ecmwf/ecbuild/archive/refs/tags/{{ ecbuild_version }}.tar.gz
    sha256: 8ebbc5eca4aa4d2af9985bf7e28f60f3da56e2409bf71d33280e0210dc0be95c
    folder: ecbuild
  - url: https://github.com/ecmwf/eckit/archive/refs/tags/{{ eckit_version }}.tar.gz
    sha256: d2aae7d8030e2ce39e5d04e36dd6aa739f3c8dfffe32c61c2a3127c36b573485
    folder: eckit
  - url: https://github.com/ecmwf/{{ name }}/archive/refs/tags/{{ version }}.tar.gz
    sha256: 97a4f10765b341cc8ccbbf203f5559cb1b838cbd945f48d4cecb1bc4305e6cd6

build:
  number: 0
  skip: True  # [win]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ compiler('fortran') }}
    - cmake
  host:
    - bison
    - bzip2
    - flex
    - libcurl
    - lz4-c
    - ncurses
    - openssl

test:
  commands:
    - test -f $PREFIX/lib64/libeckit.so  # [linux]
    - test -f $PREFIX/lib64/libeckit.dylib  # [osx]
    - test -f $PREFIX/bin/eckit-version
    - test -f $PREFIX/lib64/libodccore.so  # [linux]
    - test -f $PREFIX/lib64/libfodc.so  # [linux]
    - test -f $PREFIX/lib64/libodccore.dylib  # [osx]
    - test -f $PREFIX/lib64/libfodc.dylib  # [osx]
    - test -f $PREFIX/bin/odc
    - $PREFIX/bin/eckit-version
    - $PREFIX/bin/odc --version

about:
  home: https://github.com/ecmwf/odc
  license: Apache-2.0
  license_family: Apache
  license_file: LICENSE
  summary: A package to read and write ODB-2 data
  description: |
    C, C++ and Fortran libraries providing encoders and decoders and
    interrogation of meteorological data encoded in ODB-2 format as well as
    command line tools for investigation and manipulation of ODB-2 data.
  doc_url: https://odc.readthedocs.io/en/latest/
  dev_url: https://github.com/ecmwf/odc

extra:
  recipe-maintainers:
    - b8raoult
    - simondsmart
    - dvuckovic
