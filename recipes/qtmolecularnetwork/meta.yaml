{% set version = "0.6.1" %}

package:
    name: qtmolecularnetwork
    version: {{ version }}

source:
    url: https://github.com/metgem/QtMolecularNetwork/archive/v{{ version }}.tar.gz
    sha256: 455329bbf0d2223637012181de6ff8b3fe9e64cb204f0c934df8a59a2a0f9692
    patches:
        - 0001-libcxx.patch                   # [linux]

build:
    number: 0
    missing_dso_whitelist:
        - $RPATH/libRDKitDepictor.1.dylib     # [osx]
        - $RPATH/libRDKitMolDraw2D.1.dylib    # [osx]
        - $RPATH/libRDKitSmilesParse.1.dylib  # [osx]
        - $RPATH/libRDKitRDInchiLib.1.dylib   # [osx]
        - $RPATH/libRDKitDepictor.so.1        # [linux]
        - $RPATH/libRDKitMolDraw2D.so.1       # [linux]
        - $RPATH/libRDKitSmilesParse.so.1     # [linux]
        - $RPATH/libRDKitRDInchiLib.so.1      # [linux]

outputs:
  - name: qtmolecularnetwork
    version: {{ version }}
    script: install_qtmolecularnetwork.bat    # [win]
    script: install_qtmolecularnetwork.sh     # [unix]
    requirements:
      build:
        - python {{ python }}
        - cmake
        - {{ compiler('cxx') }}
        - make                                # [not win]
        - rdkit-dev
        - eigen
        - mesalib                             # [unix]
        - make                                # [not win]
      host:
        - qt-main >=5.15
      run:
        - qt-main >=5.15
        - rdkit
    test:
      commands:
        - if not exist %LIBRARY_BIN%\\qtmolecularnetwork.dll exit 1  # [win]
        - test -f $PREFIX/lib/libqtmolecularnetwork${SHLIB_EXT}      # [unix]

  - name: pyside2mn
    build:
      script: python -m pip install . -vv
      script_env:
        - CMAKE_GENERATOR_PLATFORM=           # [win]
        - CMAKE_GENERATOR_TOOLSET=            # [win]
        - CMAKE_GENERATOR=                    # [win]
    version: {{ version }}
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - clangdev
        - cmake
        - make                                # [not win]
        - libcxx                              # [linux]
        - {{ cdt('mesa-libgl-devel') }}       # [linux]
        - {{ cdt('mesa-dri-drivers') }}       # [linux]
        - {{ cdt('libselinux') }}             # [linux]
        - {{ cdt('libxdamage') }}             # [linux]
        - {{ cdt('libxxf86vm') }}             # [linux]
        - {{ cdt('libxext') }}                # [linux]
      host:
        - qtmolecularnetwork
        - python {{ python }}
        - rdkit-dev
        - pyside2 >=5.15
        - qt-main >=5.15
        - eigen
        - pip
        - setuptools
        - libclang
      run:
        - python
        - qtmolecularnetwork
        - pywin32                             # [win]
        - pyside2 >=5.15
        - qt-main >=5.15
        - rdkit
        - tinycss2
    test:
      imports:
        - PySide2MolecularNetwork
        - PySide2MolecularNetwork.qmn

about:
    home: https://github.com/metgem/QtMolecularNetwork
    license: GPL-3.0
    license_family: GPL
    license_file: 'LICENSE'
    summary: 'Widgets used for visualisation of graph in MetGem'
    description: 'Widgets used for visualisation of graph in `MetGem`'
    doc_url: ''
    dev_url: 'https://github.com/metgem/QtMolecularNetwork'

extra:
    recipe-maintainers:
      - n-elie
