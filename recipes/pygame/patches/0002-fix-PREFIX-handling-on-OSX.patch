From ab8f58e6683ff6c875da9caeb1163141d6cad6c8 Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Sun, 17 Jul 2022 23:41:27 +0200
Subject: [PATCH 2/4] fix PREFIX-handling on OSX

---
 buildconfig/config_darwin.py | 13 ++++---------
 buildconfig/config_win.py    |  8 +++++---
 2 files changed, 9 insertions(+), 12 deletions(-)

diff --git a/buildconfig/config_darwin.py b/buildconfig/config_darwin.py
index c785e183..e7fce48e 100644
--- a/buildconfig/config_darwin.py
+++ b/buildconfig/config_darwin.py
@@ -146,16 +146,11 @@ def main():
     ])
 
     print ('Hunting dependencies...')
-    incdirs = ['/usr/local/include', '/opt/homebrew/include']
-    incdirs.extend(['/usr/local/include/SDL2', '/opt/homebrew/include/SDL2', '/opt/local/include/SDL2'])
+    incdirs = [os.environ['PREFIX'] + '/include',
+               os.environ['PREFIX'] + '/include/SDL2',
+               os.environ['PREFIX'] + '/include/freetype2/freetype']
 
-    incdirs.extend([
-       #'/usr/X11/include',
-       '/opt/local/include',
-       '/opt/local/include/freetype2/freetype']
-    )
-    #libdirs = ['/usr/local/lib', '/usr/X11/lib', '/opt/local/lib']
-    libdirs = ['/usr/local/lib', '/opt/local/lib', '/opt/homebrew/lib']
+    libdirs = [os.environ['PREFIX'] + '/lib']
 
     for d in DEPS:
         if isinstance(d, (list, tuple)):
diff --git a/buildconfig/config_win.py b/buildconfig/config_win.py
index 5ce832a7..ffa0e56a 100644
--- a/buildconfig/config_win.py
+++ b/buildconfig/config_win.py
@@ -30,7 +30,8 @@ def get_machine_type():
     return as_machine_type(get_ptr_size())
 
 class Dependency(object):
-    huntpaths = [os.environ['LIBRARY_PREFIX']]
+    huntpaths = [os.environ['LIBRARY_PREFIX'], os.environ['LIBRARY_LIB'],
+                 os.environ['LIBRARY_INC']]
     inc_hunt = ['include', 'include\\SDL2']
     lib_hunt = ['lib', 'bin']
     check_hunt_roots = True
@@ -473,8 +474,9 @@ def setup_prebuilt_sdl2(prebuilt_dir):
 
 def main():
     machine_type = get_machine_type()
-    prebuilt_dir = os.environ["LIBRARY_PREFIX"]
-    use_prebuilt = True
+    # avoid triggering unwanted branches below
+    prebuilt_dir = ''
+    use_prebuilt = False
 
     auto_download = False
     if auto_download:
-- 
2.37.0.windows.1

