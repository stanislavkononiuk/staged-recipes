{% set name = "ucrt" %}
{% set version = "10.0.20348.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://software-download.microsoft.com/download/sg/20348.1.210507-1500.fe_release_WindowsSDK.iso
  sha256: a0cdc3fc9db69084c8dd8c09ee153c1a168366ac4dfc3d890abbf0bf17e635dc

build:
  number: 0
  script:
    - mkdir -p $PREFIX/Library/bin
    - 7z x 20348.1.210507-1500.fe_release_WindowsSDK.iso -aoa
    - msiextract -C tmp "Installers/Universal CRT Redistributable-x86_en-us.msi"
    - cp "tmp/Program Files/Windows Kits/10/Redist/{{ version }}/ucrt/DLLs/x64/"* $PREFIX
    - cp "tmp/Program Files/Windows Kits/10/Redist/{{ version }}/ucrt/DLLs/x64/"* $PREFIX/Library/bin

  # This is supposed to be a win-64 package only, but it is noarch: generic because
  # I don't want to write this in cmd.
  noarch: generic

requirements:
  build:
    - p7zip
    - msitools
  host:
  run:
  run_constrained:
    - vs2015_runtime >=14.29.30037

test:
  commands:
    - test -f $PREFIX/ucrtbase.dll
    - test -f $PREFIX/Library/bin/ucrtbase.dll

about:
  home: https://developer.microsoft.com/en-us/windows/downloads/windows-10-sdk/
  license: LicenseRef-Proprietary
  license_file: LICENSE.txt
  summary: 'Redistributable files for Windows SDK. This is only needed Windows <10'

extra:
  recipe-maintainers:
    - isuruf
