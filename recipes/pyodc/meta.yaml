{% set name = "pyodc" %}
{% set version = "1.0.4" %}


package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/ecmwf/{{ name }}/archive/refs/tags/{{ version }}.tar.gz
  sha256: da46650ddc32395fcc44b0ae394f575b5debee69db1eb51db9994cf079800246
  patches:
    - 0001-ODB-531-Fix-utf-8-null-encoding-for-python-3.9-incom.patch

build:
  number: 0
  noarch: python
  script: {{ PYTHON }} -m pip install . -vv

requirements:
  host:
    - python >=3.6
    - pip
  run:
    - python >=3.6
    - cffi
    - pandas

test:
  imports:
    - pyodc
  requires:
    - pip
    - pytest
    - odc
  source_files:
    - CHANGELOG.rst
    - codc
    - tests
    - pyodc
    - README.rst
    - setup.py
  commands:
    - pip check
    - ODC_DIR=$PREFIX python -c "import codc"
    - ODC_DIR=$PREFIX python -m pytest

about:
  home: https://pypi.org/project/pyodc/
  license: Apache-2.0
  license_family: Apache
  license_file: LICENSE
  summary: 'A Python interface to odc for encoding/decoding ODB-2 files'
  description: |
    The package contains two different implementations of the same library:

    * pyodc is a pure-python encoder and decoder for ODB-2 data, which encodes
      data from, and decodes it into pandas data frames
    * codc is an implementation of the same API as pyodc that depends on the
      ECMWF odc library, and comes with _much_ better performance
  doc_url: https://pyodc.readthedocs.io/en/latest/
  dev_url: https://github.com/ecmwf/pyodc

extra:
  recipe-maintainers:
    - b8raoult
    - simondsmart
    - dvuckovic
