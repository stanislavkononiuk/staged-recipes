{% set gfortran_version = [7, 3, 0] %}
{% set libgfortran_version = [4, 0, 0] %}
{% set max_libgfortran_version = [4, 0, 1] %}
{% set chost = "x86_64-apple-darwin13.4.0" %}

package:
  name: gfortran_osx-64
  version: {{ gfortran_version|join('.') }}

build:
  number: 0
  skip: True  # [not osx]
  binary_has_prefix_files:
    - lib/libgcc_ext.10.*.dylib
  always_include_files:
    - bin/gfortran
    - bin/{{ chost }}-gfortran

    - libexec/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/collect2
    - libexec/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/f951
    - libexec/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/lto-wrapper

    - lib/libgfortran.spec

    # For -fopenmp:
    - lib/libgomp.spec

    # For -ffast-math
    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/crtfastmath.o

    # For -static:
    - lib/libgfortran.a
    - lib/libgomp.a

    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/libgcc.a
    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/libgcc_eh.a

    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/finclude/**

    # include{,-fixed} may not be needed unless -fopenmp is passed (not sure on that):
    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/include-fixed/**
    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/include/**

    # Stub libraries:
    - lib/libgcc_ext.10.4.dylib
    - lib/libgcc_ext.10.5.dylib

  run_exports:
    strong:
      - libgfortran >={{ libgfortran_version|join('.') }},<{{ max_libgfortran_version|join('.') }}

requirements:
  host:
    - gfortran_impl_osx-64 ={{ gfortran_version|join('.') }}
  run:
    - libgfortran >={{ libgfortran_version|join('.') }},<{{ max_libgfortran_version|join('.') }}
    - {{ pin_compatible('isl', max_pin='x.x') }}
    - {{ pin_compatible('mpfr', max_pin='x.x') }}
    - {{ pin_compatible('mpc', max_pin='x.x') }}
    - {{ pin_compatible('gmp', max_pin='x.x') }}
    - {{ pin_compatible('zlib', max_pin='x.x') }}
    - {{ pin_compatible('libiconv', max_pin='x.x') }}

test:
  files:
    - hello.f90
    - maths.f90
  commands:
    - gfortran --help

about:
  home: http://gcc.gnu.org/
  license: GPL 3 (with GCC Runtime Library Exception 3.1)
  license_family: GPL
  summary: Fortran libraries from the GNU Compiler Collection

extra:
  recipe-maintainers:
    - jakirkham
    - msarahan
    - pelson
    - beckermr
