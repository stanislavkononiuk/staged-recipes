From 135bcc60e8b403ec6c9b71b985c86f5d4be48b5b Mon Sep 17 00:00:00 2001
From: Samee <sameeul@gmail.com>
Date: Thu, 22 Sep 2022 20:55:56 +0000
Subject: [PATCH] Fix CUDA Kernel Issue

---
 CMakeLists.txt       | 5 ++++-
 tests/CMakeLists.txt | 2 +-
 2 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 4a845e1..531775e 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -34,6 +34,9 @@ set(CMAKE_CXX_STANDARD_REQUIRED ON)
 if(USEGPU)
     enable_language("CUDA")
     add_definitions(-DUSE_GPU)
+	SET(CMAKE_CUDA_ARCHITECTURES ${CUDA_ARCH_LIST})
+	set_property(GLOBAL PROPERTY CUDA_ARCHITECTURES "${CUDA_ARCH_LIST}")
+	message("Building with compute capability for ${CUDA_ARCH_LIST}.")
 	if (CUDA_VERSION_MAJOR STREQUAL "10")
 		set(CMAKE_CUDA_STANDARD 14)
 	elseif (CUDA_VERSION_MAJOR STREQUAL "11")
@@ -200,13 +203,13 @@ else ()
 endif ()
 
 if(USEGPU)
+	include_directories("${CUDA_INCLUDE_DIRS}")
 	set(GPU_SOURCE_FILES
 		src/nyx/gpu/gpu_helpers.cu
 		src/nyx/gpu/image_moments.cu
         src/nyx/gpu/gabor.cu
 	)
 	add_library(nyxus_gpu ${GPU_SOURCE_FILES})
-
 	if(CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
 		target_compile_options(nyxus_gpu PRIVATE $<$<COMPILE_LANGUAGE:CUDA>:-fPIC>)
 	endif()
diff --git a/tests/CMakeLists.txt b/tests/CMakeLists.txt
index 7f0c9c7..a85db5f 100755
--- a/tests/CMakeLists.txt
+++ b/tests/CMakeLists.txt
@@ -111,7 +111,7 @@ if(USEGPU)
 	)
 
 	target_sources(runAllTests PRIVATE ${GPU_SOURCE_FILES})
-	
+	include_directories("${CUDA_INCLUDE_DIRS}")
 	if(CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
 		target_compile_options(runAllTests PRIVATE $<$<COMPILE_LANGUAGE:CUDA>:-fPIC>)
 	endif()
-- 
2.32.0

