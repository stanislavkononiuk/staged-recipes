{% set name = "ldc" %}
{% set version = "1.9.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - url: https://github.com/ldc-developers/ldc/releases/download/v{{ version }}/ldc-{{ version }}-src.tar.gz
    sha256: e3f32a4dfcaae12f434e0e23638684faa83765827e7f2deb2df059dccc3169b9

  # bootstrap with 0.17.x which is the last version that doesn't require a host D compiler.
  # See https://wiki.dlang.org/Building_LDC_from_source
  # Use ltsmaster branch until https://github.com/ldc-developers/ldc/issues/2663 is fixed and 0.17.6 is released
  - url: https://github.com/ldc-developers/ldc/archive/ltsmaster.tar.gz         # [unix]
    sha256: ad35323efa5bf0908b05ec69ca55915fc31299be7a779898bbce214b3fb3322b    # [unix]
    folder: lts                                                                 # [unix]

  # Use the 1.9.0 release to build the latest version. This does not need to be updated every version
  - url: https://github.com/ldc-developers/ldc/releases/download/v1.9.0/ldc2-1.9.0-windows-x64.7z  # [win64]
    sha256: 17fb0f2f1865e796f05d74fde6b3353c4c1d8a779e2dc51449b9c4b5b5c5ea9a                       # [win64]
    folder: lts                                                                                    # [win64]

build:
  number: 0
  skip: true  # [win]

requirements:
    build:
      - {{ compiler('c') }}
      - {{ compiler('cxx') }}
      - git
      - cmake
      - ninja
    host:
      - libconfig     # [unix]
      - curl
      - libedit
      - llvmdev
      - ncurses
    run:
      - ncurses

test:
  commands:
    - ldc2 --version

about:
  home: https://github.com/ldc-developers/ldc
  license: BSD, MIT, LDC
  license_file: LICENSE
  summary: 'The LLVM-based D Compiler'

  description: |
    The LDC project provides a portable D programming language compiler with modern optimization and code generation capabilities.
    The compiler uses the official DMD frontend to support the latest version of D2, and relies on the LLVM Core libraries for code generation.
  doc_url: https://wiki.dlang.org/LDC
  dev_url: https://github.com/ldc-developers/ldc 

extra:
  recipe-maintainers:
    - brainstorm
