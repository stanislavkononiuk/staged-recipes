From a3678cacc13c1a23e6ad4424f2e7ad1a5b9ea762 Mon Sep 17 00:00:00 2001
From: Nehal J Wani <nehaljw.kkd1@gmail.com>
Date: Sun, 24 Dec 2017 16:01:43 +0530
Subject: [PATCH 1/2] Catch correct exception in _is_ipv6_enabled()

---
 src/backports/test/support/__init__.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/backports/test/support/__init__.py b/src/backports/test/support/__init__.py
index ab99b60..45d564a 100644
--- a/src/backports/test/support/__init__.py
+++ b/src/backports/test/support/__init__.py
@@ -735,7 +735,7 @@ def _is_ipv6_enabled():
             sock = socket.socket(socket.AF_INET6, socket.SOCK_STREAM)
             sock.bind((HOSTv6, 0))
             return True
-        except OSError:
+        except (socket.error, socket.gaierror):
             pass
         finally:
             if sock:

From bc972045f501098728de23520c659c9cf1b7d35c Mon Sep 17 00:00:00 2001
From: Pi Delport <pjdelport@gmail.com>
Date: Sun, 24 Dec 2017 13:10:59 +0200
Subject: [PATCH 2/2] Tweak fixed except clause, mark with comment

This only catches socket.error (referenced from the older Python code),
and retains the newer OSError code on Python 3.3+.
---
 src/backports/test/support/__init__.py | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/backports/test/support/__init__.py b/src/backports/test/support/__init__.py
index 45d564a..98ec525 100644
--- a/src/backports/test/support/__init__.py
+++ b/src/backports/test/support/__init__.py
@@ -735,7 +735,8 @@ def _is_ipv6_enabled():
             sock = socket.socket(socket.AF_INET6, socket.SOCK_STREAM)
             sock.bind((HOSTv6, 0))
             return True
-        except (socket.error, socket.gaierror):
+        # XXX backport: Python 3.3 / PEP 3151 exception reworking.
+        except socket.error if sys.version_info < (3, 3) else OSError:
             pass
         finally:
             if sock:
