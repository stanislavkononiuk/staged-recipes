{% set version = "1.2.0" %}

package:
  name: cutensor
  version: {{ version }}

source:
  url: https://github.com/JuliaBinaryWrappers/CUTENSOR_CUDA101_jll.jl/releases/download/CUTENSOR_CUDA101-v{{ version }}%2B0/CUTENSOR_CUDA101.v{{ version }}.x86_64-linux-gnu.tar.gz  # [linux64 and cuda_compiler_version == "10.1"]
  url: https://github.com/JuliaBinaryWrappers/CUTENSOR_CUDA102_jll.jl/releases/download/CUTENSOR_CUDA102-v{{ version }}%2B0/CUTENSOR_CUDA102.v{{ version }}.x86_64-linux-gnu.tar.gz  # [linux64 and cuda_compiler_version == "10.2"]
  url: https://github.com/JuliaBinaryWrappers/CUTENSOR_CUDA110_jll.jl/releases/download/CUTENSOR_CUDA110-v{{ version }}%2B0/CUTENSOR_CUDA110.v{{ version }}.x86_64-linux-gnu.tar.gz  # [linux64 and cuda_compiler_version == "11.0"]
  sha256: df9e79b72bd0e862443b485694a66f09811181e822b2ca5526a373ed7c18b632  # [linux64 and cuda_compiler_version == "10.1"]
  sha256: 086c7717d18632ba3027d37d3d0e2b27995996407474f2f0845b51e18ca34bde  # [linux64 and cuda_compiler_version == "10.2"]
  sha256: 33d301405a4e6e10d3c44304c419b004f0cfc89a1e81cc483b4b2067b6f1b0bb  # [linux64 and cuda_compiler_version == "11.0"]

  url: https://github.com/JuliaBinaryWrappers/CUTENSOR_CUDA101_jll.jl/releases/download/CUTENSOR_CUDA101-v{{ version }}%2B0/CUTENSOR_CUDA101.v{{ version }}.powerpc64le-linux-gnu.tar.gz  # [ppc64le and cuda_compiler_version == "10.1"]
  url: https://github.com/JuliaBinaryWrappers/CUTENSOR_CUDA102_jll.jl/releases/download/CUTENSOR_CUDA102-v{{ version }}%2B0/CUTENSOR_CUDA102.v{{ version }}.powerpc64le-linux-gnu.tar.gz  # [ppc64le and cuda_compiler_version == "10.2"]
  url: https://github.com/JuliaBinaryWrappers/CUTENSOR_CUDA110_jll.jl/releases/download/CUTENSOR_CUDA110-v{{ version }}%2B0/CUTENSOR_CUDA110.v{{ version }}.powerpc64le-linux-gnu.tar.gz  # [ppc64le and cuda_compiler_version == "11.0"]
  sha256: 0f66003f90e2554622f7f1bcd50202b4cb6428de6cf8315cb65c29efd5f66c55  # [ppc64le and cuda_compiler_version == "10.1"]
  sha256: 1148373079d63cb4517259d65353a2f9e7f0d109bb05f219019caf80b75b1122  # [ppc64le and cuda_compiler_version == "10.2"]
  sha256: 5f0ce5d2d0f94c7d096bf6317d5425e66381ec9aa41942904570f982a03a4269  # [ppc64le and cuda_compiler_version == "11.0"]

  url: https://github.com/JuliaBinaryWrappers/CUTENSOR_CUDA101_jll.jl/releases/download/CUTENSOR_CUDA101-v{{ version }}%2B0/CUTENSOR_CUDA101.v{{ version }}.x86_64-w64-mingw32.tar.gz  # [win64 and cuda_compiler_version == "10.1"]
  url: https://github.com/JuliaBinaryWrappers/CUTENSOR_CUDA102_jll.jl/releases/download/CUTENSOR_CUDA102-v{{ version }}%2B0/CUTENSOR_CUDA102.v{{ version }}.x86_64-w64-mingw32.tar.gz  # [win64 and cuda_compiler_version == "10.2"]
  url: https://github.com/JuliaBinaryWrappers/CUTENSOR_CUDA110_jll.jl/releases/download/CUTENSOR_CUDA110-v{{ version }}%2B0/CUTENSOR_CUDA110.v{{ version }}.x86_64-w64-mingw32.tar.gz  # [win64 and cuda_compiler_version == "11.0"]
  sha256: 5efce496c330cd9f6df38b93e605127977f0221ca023a4c864bb9e2bc48dd595  # [win64 and cuda_compiler_version == "10.1"]
  sha256: 23830ae8da7eaaaef63b572ff19a47f3a86ca7124b8ce2c85bd76286cbf58014  # [win64 and cuda_compiler_version == "10.2"]
  sha256: a2ff02ca1003f6e96e63335e6296637173d02cf9d44892225815679dc9c13ee7  # [win64 and cuda_compiler_version == "11.0"]

build:
  number: 0
  skip: True  # [cuda_compiler_version in ("None", "9.2", "10.0")]
  script:
    - mkdir -p $PREFIX/include                                            # [unix]
    - cp -r include/* $PREFIX/include/                                    # [unix]
    - mkdir -p $PREFIX/lib                                                # [unix]
    - mv lib/libcutensor.so* $PREFIX/lib/                                 # [unix]

    - mkdir %LIBRARY_INC%                                                 # [win64]
    - copy %SRC_DIR%\\include\\cutensor.h %LIBRARY_INC%\\                 # [win64]
    - mkdir %LIBRARY_INC\\cutensor%                                       # [win64]
    - copy %SRC_DIR%\\include\\cutensor\\types.h %LIBRARY_INC%\\cutensor  # [win64]
    - mkdir %LIBRARY_BIN%                                                 # [win64]
    - copy %SRC_DIR%\\bin\\cutensor.dll %LIBRARY_BIN%\\                   # [win64]
  ignore_run_exports_from:
    - {{ compiler('c') }}    # [linux]
  run_exports:
    - {{ pin_subpackage('cutensor') }}
  missing_dso_whitelist:
    - '*/libgomp.*'  # [linux]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cuda') }}
    - sysroot_linux-64 2.17  # [linux64]
    - libgomp  # [linux]
  run:
    # Only GCC_3.0 or older symbols present
    - libgcc-ng >=3.0     # [linux]
    # Only GLIBCXX_3.4 or older symbols present
    - libstdcxx-ng >=3.4  # [linux]
  run_constrained:
    # Only GLIBC_2.17 or older symbols present
    - __glibc >=2.17      # [linux]

test:
  commands:
    - test -f $PREFIX/include/cutensor.h                    # [linux]
    - test -f $PREFIX/include/cutensor/types.h              # [linux]
    - test -f $PREFIX/lib/libcutensor.so                    # [linux]

    - if not exist %LIBRARY_INC%\\cutensor.h exit 1         # [win]
    - if not exist %LIBRARY_INC%\\cutensor\\types.h exit 1  # [win]
    - if not exist %LIBRARY_BIN%\\cutensor.dll exit 1       # [win]

about:
  home: https://developer.nvidia.com/cutensor
  license: NVIDIA Software License Agreement for the HPC Software Development Kit
  license_url: https://docs.nvidia.com/hpc-sdk/eula/index.html
  license_file: share/licenses/CUTENSOR_CUDA101/license.pdf  # [cuda_compiler_version == "10.1"]
  license_file: share/licenses/CUTENSOR_CUDA102/license.pdf  # [cuda_compiler_version == "10.2"]
  license_file: share/licenses/CUTENSOR_CUDA110/license.pdf  # [cuda_compiler_version == "11.0"]
  summary: "Tensor Linear Algebra on NVIDIA GPUs"
  description: |
    The cuTENSOR Library is a first-of-its-kind GPU-accelerated tensor linear
    algebra library providing tensor contraction, reduction and elementwise
    operations. cuTENSOR is used to accelerate applications in the areas of
    deep learning training and inference, computer vision, quantum chemistry
    and computational physics.

    License Agreements:- The packages are governed by the NVIDIA Software
    License Agreement for the HPC Software Development Kit. By downloading
    and using the packages, you accept the terms and conditions of the EULA -
    https://docs.nvidia.com/hpc-sdk/eula/index.html
  doc_url: https://docs.nvidia.com/cuda/cutensor/index.html
  dev_url: https://developer.nvidia.com/cutensor/downloads

extra:
  recipe-maintainers:
    - leofang
