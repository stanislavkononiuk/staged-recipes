{% set name = "dials" %}
{% set version = "3.10.dev1" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/dials/dials/archive/refs/tags/v{{ version }}.tar.gz
  sha256: 572b1ce7366f8bde14a4e6df9649e426b6dd23a4ee16d2ab3e35151300dd9551
  folder: dials

build:
  skip: True  # [win]
  number: 0

requirements:
  build:
    - {{ compiler('cxx') }}
    - cmake
    - ninja
  host:
    - boost
    - boost-cpp
    - cctbx-base
    - dxtbx
    - msgpack-c
    - pip
    - python
  run:
    - {{ pin_compatible('boost') }}
    - {{ pin_compatible('cctbx-base') }}
    - {{ pin_compatible('dxtbx') }}
    - boost-cpp
    - cctbx
    - gemmi
    - h5py
    - jinja2
    - matplotlib-base
    - numpy
    - orderedset
    - pandas
    - procrunner
    - pycbf
    - python
    - scikit-learn
    - scipy
    - tabulate
    - tqdm
    - wxpython

test:
  source_files:
    - dials/tests
    - dials/conftest.py
  requires:
    - dials-data
    - pip
    - pytest
    - pytest-forked
    - pytest-mock
    - pytest-xdist
  imports:
    - dials
  commands:
    - pytest $SRC_DIR/dials/tests --regression -n auto
    - pip check

about:
  home: https://github.com/dials/dials
  license: BSD-3-Clause
  license_family: BSD
  license_file: dials/LICENSE
  summary: 'Diffraction Integration for Advanced Light Sources'
  description: |
    The DIALS project is a collaborative endeavour to develop new diffraction
    integration software to meet the data analysis requirements presented by recent
    advances in high performance pixel array detectors, new beamlines capable of
    delivering micron and sub-micron focus and new light sources such as XFELs.
  doc_url: https://dials.github.io/documentation/index.html
  dev_url: https://github.com/dials/dials

extra:
  recipe-maintainers:
    - anthchirp
    - ndevenish
    - rjgildea
