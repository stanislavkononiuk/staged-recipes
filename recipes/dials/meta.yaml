{% set name = "dials" %}
{% set version = "3.10.b0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  git_url: https://github.com/dials/dials.git
  git_rev: cmake_src
  folder: dials

build:
  skip: True  # [win]
  number: 0

requirements:
  build:
    - {{ compiler('cxx') }}
    - cmake
    - ninja
  host:
    - dxtbx
    - msgpack-c
    - pip
    - boost
    - boost-cpp
    - cctbx-base
    - python
  run:
    - {{ pin_compatible('boost') }}
    - boost-cpp
    - {{ pin_compatible('cctbx-base') }}
    - cctbx
    - {{ pin_compatible('dxtbx') }}
    - h5py
    - jinja2
    - matplotlib-base
    - {{ pin_compatible('numpy') }}
    - orderedset
    - pandas
    - procrunner
    - pycbf
    - python
    - scipy
    - scikit-learn
    - tabulate
    - tqdm
    - wxpython

test:
  source_files:
    - dials/tests
    - dials/conftest.py
  requires:
    - dials-data
    - pytest
    - pytest-mock
    - pytest-forked
    - pytest-xdist
    - pip
  imports:
    - dials
  commands:
    - pytest $SRC_DIR/dials/tests --regression
    - pip check

about:
  home: https://github.com/dials/dials
  license: BSD-3-Clause
  license_family: BSD
  license_file: dials/LICENSE
  summary: 'Diffraction Integration for Advanced Light Sources'
  description: |
    The DIALS project is a collaborative endeavour to develop new diffraction
    integration software to meet the data analysis requirements presented by recent
    advances in high performance pixel array detectors, new beamlines capable of
    delivering micron and sub-micron focus and new light sources such as XFELs.
  doc_url: https://dials.github.io/documentation/index.html
  dev_url: https://github.com/dials/dials

extra:
  recipe-maintainers:
    - ndevenish
    - rjgildea
    - anthchirp
