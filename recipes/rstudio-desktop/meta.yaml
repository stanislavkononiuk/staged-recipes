{% set version = "2022.02.0" %}

package:
  name: rstudio
  version: {{ version }}

source:
  url: "https://github.com/rstudio/rstudio/archive/refs/tags/v{{ version }}+443.tar.gz"
  sha256: 36234218f118f5085e417411e137791072c00380bce6a016e551e6ecb404ae4d
  patches:
    - 0001-fix-soci.patch
    - sigstksz_gcc11.patch

build:
  number: 0
  skip: true  # [not linux]
  ignore_run_exports: r-base
  rpaths:
    - lib/R/lib/
    - lib/rstudio/lib
    - lib/

requirements:
  build:
    - {{ compiler('cxx') }}
    - make
    - cmake
    - ant
    - yarn
    - wget
    - patchelf
    - unzip
    - nodejs 14
    - {{ cdt('mesa-libgl-devel') }}  # [linux]
    - {{ cdt('mesa-dri-drivers') }}  # [linux]
    - {{ cdt('libselinux') }}  # [linux]
    - {{ cdt('libxdamage') }}  # [linux]
    - {{ cdt('libxxf86vm') }}  # [linux]
    - {{ cdt('libxext') }}     # [linux]

outputs:
  - name: rstudio-desktop
    script: build-desktop.sh
    build:
      skip: true  # [not linux]
      rpaths:
        - lib/R/lib/
        - lib/rstudio/lib
        - lib/
      ignore_run_exports: r-base
    requirements:
      build:
        - {{ compiler('cxx') }}
        - make
        - cmake
        - ant
        - yarn
        - wget
        - patchelf
        - unzip
        - nodejs =14
        - {{ cdt('mesa-libgl-devel') }}  # [linux]
        - {{ cdt('mesa-dri-drivers') }}  # [linux]
        - {{ cdt('libselinux') }}  # [linux]
        - {{ cdt('libxdamage') }}  # [linux]
        - {{ cdt('libxxf86vm') }}  # [linux]
        - {{ cdt('libxext') }}     # [linux]
      host:
        - r-base 4.1
        - r-purrr
        - r-rmarkdown
        - r-renv
        - r-testthat
        - r-xml2
        - r-yaml
        - r-rstudioapi
        - libxkbcommon  # [linux]
        - openjdk
        - boost
        - boost-cpp
        - soci-postgresql
        - soci-core
        - soci-sqlite
        - libpq
        - qt
        - libuuid
        - bzip2
        - zlib
        - pango
        - sqlite
        - libcups
        - openssl
        - hunspell
        - hunspell-en
        - pandoc
        - mathjax <3.0
        - yaml-cpp
      run:
        - {{ pin_compatible('r-base', max_pin='x') }}
        - r-purrr
        - r-rmarkdown
        - r-renv
        - r-testthat
        - r-xml2
        - r-yaml
        - r-rstudioapi
        - libxkbcommon  # [linux]
        - openjdk
        - boost
        - boost-cpp
        - soci-postgresql
        - soci-core
        - soci-sqlite
        - libpq
        - qt
        - libuuid
        - bzip2
        - zlib
        - pango
        - sqlite
        - libcups
        - openssl
        - hunspell
        - hunspell-en
        - pandoc
        - mathjax <3.0
        - yaml-cpp
    test:
      commands:
        - test -f ${PREFIX}/lib/rstudio/bin/rstudio

about:
  home: www.rstudio.com/products/rstudio/
  license: GPL-3.0-or-later
  license_file: COPYING
  doc_url: https://github.com/rstudio/rstudio
  summary: RStudio is an integrated development environment (IDE) for R

about:
  home: https://www.rstudio.com/
  license: AGPL-3.0-only
  license_family: GPL
  license_file: COPYING
  summary: RStudio is an integrated development environment (IDE) for R
  description: |
    RStudio is an integrated development environment (IDE)
    for R. It includes a console, syntax-highlighting
    editor that supports direct code execution, as well
    as tools for plotting, history, debugging and
    workspace management.
  doc_url: https://support.rstudio.com/hc/en-us/sections/200107586-Using-RStudio
  dev_url: https://github.com/rstudio/rstudio

  
extra:
  recipe-maintainers:
    - izahn
