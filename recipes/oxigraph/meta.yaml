{% set version = "0.2.5" %}
{% set build_number = 0 %}
{% set min_rust = "rust >=1.54" %}

package:
  name: oxigraph
  version: {{ version }}

source:
  url: https://github.com/oxigraph/oxigraph/archive/refs/tags/v{{ version }}.tar.gz
  sha256: f9855472dcf746f97d80cba36ae95abdfa0b0429932b527f7288371c858bc6a8

build:
  number: {{ build_number }}

outputs:
  - name: oxigraph-server
    build:
      number: {{ build_number }}
      script:
        - bash {{ RECIPE_DIR }}/build-oxigraph.sh  # [unix]
        - call {{ RECIPE_DIR }}\bld-oxigraph.bat  # [win]
    requirements:
      build:
        - {{ compiler('c') }}                    # [unix]
        - {{ compiler('cxx') }}                  # [unix]
        - {{ compiler('m2w64_c') }}              # [win]
        - {{ compiler('m2w64_cxx') }}            # [win]
        - {{ min_rust }}
      host:
        - clangdev                               # [not osx]
        - openssl
    test:
      commands:
        - oxigraph_server --version
        - oxigraph_server --help
    about:
      home: https://oxigraph.org
      summary: Oxigraph Server is a standalone HTTP server providing a graph database implementing the SPARQL standard.
      license: Apache-2.0 OR MIT
      license_file:
      - LICENSE-APACHE
      - LICENSE-MIT
      dev_url: https://github.com/oxigraph/oxigraph/tree/master/server
      doc_url: https://oxigraph.org

  - name: oxigraph-wikibase
    build:
      number: {{ build_number }}
      script:
        - bash {{ RECIPE_DIR }}/build-oxigraph.sh  # [unix]
        - call {{ RECIPE_DIR }}\bld-oxigraph.bat  # [win]
    requirements:
      build:
        - {{ compiler('c') }}                    # [unix]
        - {{ compiler('cxx') }}                  # [unix]
        - {{ compiler('m2w64_c') }}              # [win]
        - {{ compiler('m2w64_cxx') }}            # [win]
        - {{ min_rust }}
      host:
        - clangdev                               # [not osx]
        - openssl
    test:
      commands:
        - oxigraph_wikibase --version
        - oxigraph_wikibase --help
    about:
      home: https://crates.io/crates/oxigraph_wikibase
      summary: Oxigraph Wikibase is a SPARQL web server able to synchronize with a Wikibase instance. It is based on Oxigraph.
      license: Apache-2.0 OR MIT
      license_file:
      - LICENSE-APACHE
      - LICENSE-MIT
      dev_url: https://github.com/oxigraph/oxigraph/tree/master/wikibase

  - name: pyoxigraph
    build:
      number: {{ build_number }}
      script:
        - bash {{ RECIPE_DIR }}/build-oxigraph.sh  # [unix]
        - call {{ RECIPE_DIR }}\bld-oxigraph.bat  # [win]
    requirements:
      build:
        - {{ compiler('c') }}                    # [unix]
        - {{ compiler('cxx') }}                  # [unix]
        - {{ compiler('m2w64_c') }}              # [win]
        - {{ compiler('m2w64_cxx') }}            # [win]
        - {{ min_rust }}
        - maturin >=0.11,<0.12
      host:
        - clangdev                               # [not osx]
        - openssl
        - python
        - pip
      run:
        - python
    test:
      source_files:
        - python/tests
      imports:
        - pyoxigraph
      commands:
        - pip check
        - cd python/tests
        - pytest -vv --cov pyoxigraph --cov-report term-missing:skip-covered --cov-fail-under 100
      requires:
        - pip
        - pytest-cov
    about:
      home: https://oxigraph.org/pyoxigraph
      summary: Python bindings of Oxigraph, a SPARQL database and RDF toolkit
      license: Apache-2.0 OR MIT
      license_file:
      - LICENSE-APACHE
      - LICENSE-MIT
      dev_url: https://github.com/oxigraph/oxigraph/tree/master/python
      doc_url: https://oxigraph.org/pyoxigraph
      doc_source_url: https://github.com/oxigraph/oxigraph/tree/v{{ version }}/python/docs

about:
  home: https://oxigraph.org
  summary: Python bindings of Oxigraph, a SPARQL database and RDF toolkit
  license: Apache-2.0 OR MIT
  license_file:
  - LICENSE-APACHE
  - LICENSE-MIT
  dev_url: https://github.com/oxigraph/oxigraph
  doc_url: https://oxigraph.org

extra:
  feedstock-name: oxigraph
  recipe-maintainers:
    - bollwyvl
